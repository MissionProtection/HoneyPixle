<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>HoneyPixel Donations</title>
<script src="https://www.paypal.com/sdk/js?client-id=AdtThNsXNlFhu8qEyQ2v0DuODtY-5ikr0cqGFJVgWdSwgo4HXJZTzxgP_wdGDuDFCKRE_l-fShMENu88"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0f172a;
      color: white;
      text-align: center;
      padding: 2rem;
    }
    .donation-box {
      background: #1e293b;
      padding: 2rem;
      border-radius: 1rem;
      max-width: 400px;
      margin: auto;
    }
    button.preset {
      margin: 0.5rem;
      padding: 0.7rem 1.5rem;
      background: #22c55e;
      color: white;
      border: none;
      border-radius: 0.5rem;
      cursor: pointer;
    }
    input[type="number"] {
      padding: 0.5rem;
      border-radius: 0.3rem;
      border: none;
      margin-top: 1rem;
      width: 100px;
      text-align: center;
    }
    #paypal-button-container {
      margin-top: 2rem;
    }
  </style>
</head>
<body>
  <div class="donation-box">
    <h1>üçØ Support HoneyPixel</h1>
    <p>Select a donation amount:</p>

    <div id="presets">
      <button class="preset" onclick="selectAmount(5)">$5</button>
      <button class="preset" onclick="selectAmount(10)">$10</button>
      <button class="preset" onclick="selectAmount(20)">$20</button>
    </div>

    <p>Or enter a custom amount:</p>
    <input type="number" id="customAmount" placeholder="USD" min="1" />

    <div id="paypal-button-container"></div>
  </div>

  <script>
    let amount = 5; // default

    function selectAmount(value) {
      document.getElementById("customAmount").value = "";
      amount = value;
      renderPayPalButton();
    }

    function renderPayPalButton() {
      document.getElementById("paypal-button-container").innerHTML = "";

      paypal.Buttons({
        style: {
          color: 'gold',
          shape: 'pill',
          label: 'paypal',
        },
        createOrder: function (data, actions) {
          const customAmount = parseFloat(document.getElementById("customAmount").value);
          amount = !isNaN(customAmount) && customAmount > 0 ? customAmount : amount;

          return actions.order.create({
            purchase_units: [{
              amount: {
                value: amount.toFixed(2)
              }
            }]
          });
        },
        onApprove: function (data, actions) {
          return actions.order.capture().then(function (details) {
            const payerName = details.payer.name?.given_name || "User";
            const username = prompt(`Thanks, ${payerName}! üéâ\nEnter your Discord username:`);

            if (username) {
              fetch("/donation-initiate", {
                method: "POST",
                headers: {
                  "Content-Type": "application/json"
                },
                body: JSON.stringify({
                  discord: username,
                  amount: amount.toFixed(2),
                  paypalOrderId: data.orderID,
                  payerEmail: details.payer.email_address || "N/A"
                })
              }).then(() => {
                alert("‚úÖ Donation received! Thank you!");
              }).catch(() => {
                alert("‚ö†Ô∏è Donation went through, but we couldn't send the payment proof to the server. Please take a screenshot showing both the payment and the date, then create a ticket.");
              });
            } else {
              alert("Donation completed, but no username was submitted.");
            }
          });
        },
        onError: function (err) {
          console.error("PayPal Error:", err);
          alert("Something went wrong with PayPal.");
        }
      }).render('#paypal-button-container');
    }

    renderPayPalButton(); // Init default
  </script>
</body>
</html>
